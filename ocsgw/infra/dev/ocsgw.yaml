apiVersion: v1
kind: Service
metadata:
  name: ocsgw-tls-proxy
  labels:
    app: ocsgw-tls-proxy
    tier: backend
spec:
  type: LoadBalancer
  loadBalancerIP: 35.240.30.51
  ports:
  - name: ocsgw-loadbalancer
    port: 3868
    targetPort: 8084
    protocol: TCP
  selector:
    app: ocsgw
    tier: backend
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: ocsgw
  labels:
    app: ocsgw
    tier: backend
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: ocsgw
        tier: backend
    spec:
      containers:
      - name: ocsgw-tls-proxy
        image: eu.gcr.io/pantel-2decb/tls-proxy:TLS_PROXY_VERSION
        imagePullPolicy: Always
        ports:
        - containerPort: 8084
      - name: ocsgw
        image: eu.gcr.io/pantel-2decb/ocsgw:OCSGW_VERSION
        imagePullPolicy: Always
        env:
        - name: GOOGLE_APPLICATION_CREDENTIALS
          value: "/config/pantel-prod.json"
        - name: GOOGLE_CLOUD_PROJECT
          value: "pantel-2decb"
        - name: OCS_GRPC_SERVER
          value: "ocs.dev.ostelco.org"
        - name: METRICS_GRPC_SERVER
          value: "metrics.dev.ostelco.org"
        ports:
        - containerPort: 3868
        volumeMounts:
        - name: config
          mountPath: "/config"
      volumes:
      - name: config
        secret:
          secretName: ocsgw-config