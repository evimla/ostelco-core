language: java

services:
  - docker

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

install: echo "skip 'gradle assemble' step"

jdk: openjdk11

# TODO vihang: fix neo4j-store:test
script: ./gradlew clean build -info --stacktrace -x neo4j-store:test -x integration

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

after_success:
  # The curl command is not always working. Kept original command in comment incase codacy updates
  #- sudo apt-get install jq
  #- wget -O ~/codacy-coverage-reporter-assembly-latest.jar $(curl https://api.github.com/repos/codacy/codacy-coverage-reporter/releases/latest | jq -r .assets[0].browser_download_url)
  - wget -O ~/codacy-coverage-reporter-assembly-latest.jar https://github.com/codacy/codacy-coverage-reporter/releases/download/4.0.3/codacy-coverage-reporter-4.0.3-assembly.jar
  - for REPORT_TARGET in $(find . -name jacocoTestReport.xml | sort); do java -cp ~/codacy-coverage-reporter-assembly-latest.jar com.codacy.CodacyCoverageReporter report -l Java -r ${REPORT_TARGET} --partial; done
  - java -cp ~/codacy-coverage-reporter-assembly-latest.jar com.codacy.CodacyCoverageReporter final



#
# Integrating sonarcloud as described in
#  https://docs.travis-ci.com/user/sonarcloud/
#

addons:
  sonarcloud:
    organization: ostelco
    token:
      secure: ZcRSUk9dhEhz9sQC3a8svXvji+GQqDAq9VC0+lHVniDTOHHrkDQ9g80vMMYIHG7X1g7bMgL3j3nQ0UHMfE0Nuk4lcri7KPjKMzqKMYpSW0BwAkMl8gfs5sBoaIUYxw2CURIFj0wE9DfyYuqfIw5cloQDh4Tf3Tudsu2C0LNffSjT9N0DhSpOLF1uzeo5AlHiGKjX6Ac65HiqsMf09aoToY1eeZ2QK/VQN4V3g23QU47TVKzbOr9km7rqF8yAkGRgXrOaqTpxhzAnGKJX2c/60+he+axSXpFIq2Jn89vqpyhTmt1HIYQdDjGsPO/fcIP5hmhOpX4HTedZHhikoXjI/N/93ikkYHHUFTqP+vvBtQ0wTqt0917RwWVXE6+XuQLHC3hxKrBeQb/DP25SN1yW1gZKB8dN1ko8+2mhCLTiGEgvoJYbZZ2rlyv1fpjlYI94Pjja3x4d3SRXyoasRsAAAPavxEhKHK7P08tmVp3bRtY5uvii4mUo+vAf/1R9qJP4WkwJDc/Vk7KIO/s0HYonwg7anLwJ7rCWT71MoksvmI7muDAHMskiLvLG70pU0xfXnFIOviPq/+Pvw3sgEOhvPUkrDPpU4SH/+P8LSsgf8mYIig4MGswIeY6ap28tuE2qbMYvp2/I4M2eaBN+QIv93TVNHNh9Y5HgAWQ7/VWO2Ys=
script:
  # other script steps might be done before running the actual analysis
  - sonar-scanner -X
